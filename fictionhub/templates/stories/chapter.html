{% extends "base.html" %}
{% load markdownify %}
{% block content %}
    
<div id="page"  class="postPage">
  <div class="row">
    <div class="large-12 columns">
      <article>
	<!-- Vote
	<div class="vote-column">
	  <div class="vote">
	    <a href="/login/"
	       class="fi-arrow-up upvote
		      {% if post in upvoted %}upvoted{% endif %}
                      {% if post in downvoted %}downvoted{% endif %}"
	       id="post-upvote-{{post.id}}"></a>
	    <div class="score"> {{post.score}} </div>
	    <a href="/login/"
	       class="fi-arrow-down downvote
		      {% if post in upvoted %}upvoted{% endif %}
                      {% if post in downvoted %}downvoted{% endif %}"
	       id="post-downvote-{{post.id}}"></a>    
	  </div> -->
	<!-- Comments
	  <div class="post-comments">
	    <span class="fi-comment">
	      <a href="{{ post.get_absolute_url }}#comments"><span class="number-of-comments"> {{post.comments.count}} </span></a>
	    </span>			      
	  </div>
	</div>	     -->	  
	<!-- Post Header -->
	<header class="post-header">
	  {% if user == story.author %}
	  <a class="edit-post" href="/story/{{story.slug}}/{{chapter.slug}}/edit">Edit</a>
	  {% endif %}	  
	    <h1> {{chapter.title}} </h1>
	  <!-- <span class="post-tagline">submitted 14 days ago by <a href="#">{{post.author}}</a></span> -->
	    <hr />
	</header>
	<!-- Post Body -->
	{{chapter.body | markdownify | safe }}
	<div class="panel">
	  {% for ch in story.chapters.all %}	  
	  <ul>
	    <li><a href="/story/{{story.slug}}/{{ch.slug}}">
		{% if ch = chapter %} <b> {% endif %}	
		  {{ch.title}}
		{% if ch = chapter %} </b> {% endif %}			  
	    </a></li>
	  </ul>
	  {% endfor %}
	</div>

	{% if prev_chapter %}
	<a class="button small previous-chapter"
	   href="/story/{{story.slug}}/{{prev_chapter.slug}}">< Previous</a>
	{% else %}										
	<a class="button small previous-chapter"
	   href="/story/{{story.slug}}">< Story</a>
	{% endif %}								
	{% if next_chapter %}
	<a class="button small next-chapter"
	   href="/story/{{story.slug}}/{{next_chapter.slug}}">Next ></a> 
	{% endif %}
	<div class="clearfix"></div>	
	<div style="width:100%; height: 20px"></div>	
      </article>
      
</div> <!-- End 12 columns -->
</div>	 <!-- End row -->

      <!-- Follow -->
<div class="row">
  <div class="large-12 columns">
    <div class="post-footer-signup panel">

      {% for hub in hubs %}
      <a href="/hub/{{hub.slug}}"class="hub-tag">{{hub.title}}</a>
      {% endfor %}
	<!-- 
	<span class="hub-tag">Writing Prompts</span>
	<span class="hub-tag">Comedy</span>
	<span class="hub-tag">Flash Fiction</span>
	-->
	<div class="author">
	  by
	  {% if story.author.external_url %}
	  <a href="{{story.author.website}}">{{story.author}}</a></span>	    
	  {% else %}
	  <a href="/user/{{story.author.username}}">{{story.author}}</a></span>
	  {% endif %}	  
	<span class="userkarma">{{story.author.karma}}</span>

	<!-- Subscribe/unsubscribe button -->
	{% if user.is_authenticated %}
	  {% if not user == story.author %} <!-- if it's not my story -->
	    {% if story.author not in user.subscribed_to.all %} <!-- if not subscribed -->
	    <a class="small button usersubscribe" style="padding:10px;margin:0 10px;"
	       href="/user/{{story.author.username}}/subscribe">
	      Subscribe <span class="subscribers">{{story.author.subscribers.count}}</a>
	    {% else %} <!-- if subscribed then unsubscribe -->
	    <a class="small button usersubscribe unsubscribe" style="padding:10px;margin:0 10px;"
	       href="/user/{{story.author.username}}/unsubscribe">
	      Ubsubscribe <span class="subscribers">{{story.author.subscribers.count}}</a>
	    {% endif %}
          {% endif %}
        {% else %} <!-- if not authenticated then send to login -->
	<a class="small button usersubscribe" style="padding:10px;margin:0 10px;"
	   href="/login/">
	  Subscribe <span class="subscribers">{{story.author.subscribers.count}}</a>
	{% endif %}
      </div> <!-- End Author -->
      </div>
    </div>
  </div>
</div>  

<!-- Comments -->
<div class="row">
  <div class="large-12 columns">
    <h4 id="comments"> Comments </h4>
      <form action="/story/{{story.slug}}/{{chapter.slug}}" method="post">{% csrf_token %}
	{{form.body}}
	<div style="float:right;">
	  <button class="button small" type="submit">Submit</button>      
	</div>
      </form>

      <div class="comments">
	{% for comment in comments %}
	<div class="comment">
	  <b>{{comment.author.username}}</b>
	  <p>
	    {{comment.body}}
	  </p>
	</div>
	{% endfor %}
      </div>
  </div>
</div>  
{% endblock content %}

