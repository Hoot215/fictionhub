{% extends "base.html" %}
{% load markdownify %}

{% block title %}
  {% if chapter %}
    {{chapter.title}}
  {% else %}
    {{story.title}}
  {% endif %}
{% endblock %}

{% block content %}
<div id="page"  class="postPage">
  <div class="row">
    <div class="large-12 columns">
      <article>
	{% include "stories/vote.html" %}
	<!-- Post Header -->
	<header class="post-header">
	  {% if user == story.author %}
	    {% if chapter %}
	    <a class="edit-post" href="/story/{{story.slug}}/{{chapter.slug}}/edit">Edit</a>
	    {% else %}
	    <a class="edit-post" href="/story/{{story.slug}}/edit">Edit</a>
	    {% endif %}
	    {% endif %}

	    {% if chapter %}
	    <h1> {{chapter.title}} </h1>	    
	    {% else %}
	    <h1> {{story.title}} </h1>	    
	    {% endif %}
	    

	  <!-- <span class="post-tagline">submitted 14 days ago by <a href="#">{{post.author}}</a></span> -->
	    <hr />
	</header>
	<!-- Post Body -->
	{% if chapter %}
	  {{chapter.body | markdownify | safe }}
	{% else %}
	  {{story.description | markdownify | safe }}
	{% endif %}
	<div class="clearfix"></div>
	<br/>
	{% if story.chapters.all %}	
	<div class="panel">
	  {% for chapter in story.chapters.all %}	  
	  <ul>
	    <li><a href="/story/{{story.slug}}/{{chapter.slug}}">{{chapter.title}}</a></li>
	  </ul>
	  {% endfor %}
	</div>
	{% endif %}	

	<!-- Button rad prev -->
	{% if prev_chapter %}
	<a class="button small previous-chapter"
	   href="/story/{{story.slug}}/{{prev_chapter.slug}}">< Previous</a>
	{% elif chapter %} <!-- If this is a chapter - go back to story -->
	<a class="button small previous-chapter"
	   href="/story/{{story.slug}}">< Story</a>
	{% endif %}								
	
	<!-- Button read next -->
	{% if first_chapter %}
	<a class="button small next-chapter"
	   href="/story/{{story.slug}}/{{first_chapter.slug}}">Read ></a>
	{% elif next_chapter %}
	<a class="button small next-chapter"
	   href="/story/{{story.slug}}/{{next_chapter.slug}}">Next ></a> 
	{% endif %}
	<div class="clearfix"></div>	
	<div style="width:100%; height: 20px"></div>	
      </article>
      
</div> <!-- End 12 columns -->
</div>	 <!-- End row -->

      <!-- Follow -->
<div class="row">
  <div class="large-12 columns">
    <div class="post-footer-signup panel">

      {% for hub in hubs %}
      <a href="/hub/{{hub.slug}}"class="hub-tag">{{hub.title}}</a>
      {% endfor %}
	<!-- 
	<span class="hub-tag">Writing Prompts</span>
	<span class="hub-tag">Comedy</span>
	<span class="hub-tag">Flash Fiction</span>
	-->
	<div class="author">
	  {% if post.author.external_url %}
	  <a href="{{story.author.website}}">{{story.author}}</a></span>	    
	  {% else %}
	  <a href="/user/{{story.author.username}}">{{story.author}}</a></span>
	  {% endif %}	  
	<span class="userkarma">{{story.author.karma}}</span>

	<!-- Subscribe/unsubscribe button -->
	{% if user.is_authenticated %}
	  {% if not user == story.author %} <!-- if it's not my story' -->
	    {% if story.author not in user.subscribed_to.all %} <!-- if not subscribed -->
	    <a class="small button usersubscribe" style="padding:10px;margin:0 10px;"
	       href="/user/{{story.author.username}}/subscribe">
	      Subscribe <span class="subscribers">{{story.author.subscribers.count}}</span>
	    </a>
	    <span class="rss-icon"><a href="/story/{{story.slug}}/feed"><i class="fi-rss large"></i></a></span>	    
	    {% else %} <!-- if subscribed then unsubscribe -->
	    <a class="small button usersubscribe unsubscribe" style="padding:10px;margin:0 10px;"
	       href="/user/{{story.author.username}}/unsubscribe">
	      Ubsubscribe <span class="subscribers">{{story.author.subscribers.count}}</span>
	    </a>
	    <span class="rss-icon"><a href="/story/{{story.slug}}/feed"><i class="fi-rss large"></i></a></span>	    
	    {% endif %}
          {% endif %}
        {% else %} <!-- if not authenticated then send to login -->
	<a class="small button usersubscribe" style="padding:10px;margin:0 10px;"
	   href="/login/?next={{request.path}}">
	  Subscribe <span class="subscribers">{{story.author.subscribers.count}}</span>
	</a>
	<span class="rss-icon"><a href="/story/{{story.slug}}/feed"><i class="fi-rss large"></i></a></span>
	{% endif %}
        </div> <!-- End Author -->
	<div class="clearfix"></div>
      </div>
    </div>
  </div>

{% include "comments/comments.html" %}

{% endblock content %}

